# -*- eval: (face-remap-add-relative 'default '(:family "BQN386 Unicode" :height 180)); -*-
#+TITLE: A quantum interpreter in BQN
#+HTML_HEAD: <link rel="stylesheet" type="text/css" href="assets/style.css"/>

** Preamble

We start by importing some required system functions and defining a namespace
with the required quantum gates:

#+name: preamble
#+begin_src bqn :exports code :results none
  Sinâ€¿Cosâ€¿GCD â† â€¢math
  U â† â€¢rand.Range
    
  g â† {
    idâ€¿xâ‡âŒ½â€¿âŠ¢ {ğ•ğ•©}Â¨ <=âŒœËœâ†•2, hâ‡-âŒ¾(1â€¿1âŠ¸âŠ‘)2â€¿2â¥ŠÃ·âˆš2
    swapâ€¿cnotâ‡âŸ¨1â€¿2, 2â€¿3âŸ© {âŒ½âŒ¾(ğ•¨âŠ¸âŠ)ğ•©}Â¨ <=âŒœËœâ†•4
    Pâ‡3â€¿3âŠ¸âŠ‘{(SinâŒ¾ğ”½â‹ˆCosâŒ¾ğ”½) ğ•©âŒ¾ğ”½ =âŒœËœâ†•4}
  }
#+end_src

** Interpreter

The quantum interpreter is based on references [[https://arxiv.org/abs/1711.02086][arXiv:1711.02086]] and [[https://arxiv.org/abs/1608.03355][arXiv:1608.03355]]:

#+name: q
#+begin_src bqn :exports code :results none
  Q â† {ğ•©}
#+end_src


** Shor's algorithm

As a test case, we employ the quantum circuit of Shor's algorithm
for src_bqn[:exports code]{nâ€¿a â† âŸ¨15, 11âŸ©}, following references
[[https://arxiv.org/abs/1804.03719][arXiv:1804.03719]] and [[https://arxiv.org/abs/2306.09122][arXiv:2306.09122]]. We also define a classical
post-processing function:

#+name: shor
#+begin_src bqn :exports code :results none
  s â† âŸ¨
    âŸ¨0âŸ©â€¿g.h â‹„ âŸ¨1âŸ©â€¿g.h â‹„ âŸ¨2âŸ©â€¿g.h
    âŸ¨2, 3âŸ©â€¿g.cnot â‹„ âŸ¨2, 4âŸ©â€¿g.cnot â‹„ âŸ¨1âŸ©â€¿g.h
    âŸ¨âŸ¨1, 0âŸ©, g.P Ï€Ã·2âŸ© â‹„ âŸ¨0âŸ©â€¿g.h
    âŸ¨âŸ¨1, 2âŸ©, g.P Ï€Ã·4âŸ© â‹„ âŸ¨âŸ¨0, 2âŸ©, g.P Ï€Ã·2âŸ© â‹„ âŸ¨2âŸ©â€¿g.h
  âŸ©

  C â† {ğ•©}
#+end_src

Wir mÃ¼ssen wissen, wir werden wissen!

#+name: run
#+begin_src bqn
  C Q s
#+end_src

#+RESULTS: run
#+begin_example
â”Œâ”€                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                 
Â· â”Œâ”€                                                   â”Œâ”€                                                   â”Œâ”€                                                   â”Œâ”€                      â”Œâ”€                      â”Œâ”€                                                   â”Œâ”€                                                          â”Œâ”€                                                   â”Œâ”€                                                                        â”Œâ”€                                                          â”Œâ”€                                                    
  Â· âŸ¨ 0 âŸ© â”Œâ”€                                           Â· âŸ¨ 1 âŸ© â”Œâ”€                                           Â· âŸ¨ 2 âŸ© â”Œâ”€                                           Â· âŸ¨ 2 3 âŸ© â”Œâ”€            Â· âŸ¨ 2 4 âŸ© â”Œâ”€            Â· âŸ¨ 1 âŸ© â”Œâ”€                                           Â· âŸ¨ 1 0 âŸ© â”Œâ”€                                                Â· âŸ¨ 0 âŸ© â”Œâ”€                                           Â· âŸ¨ 1 2 âŸ© â”Œâ”€                                                              Â· âŸ¨ 0 2 âŸ© â”Œâ”€                                                Â· âŸ¨ 2 âŸ© â”Œâ”€                                            
          â•µ 0.7071067811865475  0.7071067811865475             â•µ 0.7071067811865475  0.7071067811865475             â•µ 0.7071067811865475  0.7071067811865475               â•µ 1 0 0 0               â•µ 1 0 0 0             â•µ 0.7071067811865475  0.7071067811865475               Â· â”Œâ”€          â”Œâ”€                                          â•µ 0.7071067811865475  0.7071067811865475               Â· â”Œâ”€                           â”Œâ”€                                         Â· â”Œâ”€          â”Œâ”€                                          â•µ 0.7071067811865475  0.7071067811865475      
            0.7071067811865475 Â¯0.7071067811865475               0.7071067811865475 Â¯0.7071067811865475               0.7071067811865475 Â¯0.7071067811865475                 0 1 0 0                 0 1 0 0               0.7071067811865475 Â¯0.7071067811865475                 â•µ 1 0 0 0   â•µ 1 0 0                     0                 0.7071067811865475 Â¯0.7071067811865475                 â•µ 1 0 0                  0   â•µ 1 0 0                  0                   â•µ 1 0 0 0   â•µ 1 0 0                     0                 0.7071067811865475 Â¯0.7071067811865475      
                                                   â”˜                                                    â”˜                                                    â”˜               0 0 0 1                 0 0 0 1                                                      â”˜                 0 1 0 0     0 1 0                     0                                                        â”˜                 0 1 0                  0     0 1 0                  0                     0 1 0 0     0 1 0                     0                                                        â”˜    
                                                     â”˜                                                    â”˜                                                    â”˜             0 0 1 0                 0 0 1 0                                                        â”˜               0 0 1 0     0 0 1                     0                                                          â”˜               0 0 1                  0     0 0 1                  0                     0 0 1 0     0 0 1                     0                                                          â”˜  
                                                                                                                                                                                     â”˜                       â”˜                                                                      0 0 0 1     0 0 0 6.123233995736766eÂ¯17                                                                          0 0 0 0.7071067811865475     0 0 0 0.7071067811865476                     0 0 0 1     0 0 0 6.123233995736766eÂ¯17                                                             
                                                                                                                                                                                       â”˜                       â”˜                                                                            â”˜                               â”˜                                                                                                 â”˜                            â”˜                           â”˜                               â”˜                                                           
                                                                                                                                                                                                                                                                                                                              â”˜                                                                                                                              â”˜                                                           â”˜                                                         
                                                                                                                                                                                                                                                                                                                                â”˜                                                                                                                              â”˜                                                           â”˜                                                       
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                  â”˜
#+end_example

The simulation can be run in the call_generate-bqn-link(), and the results can be
compared with those from a real [[./ibm_eagle/shor_factorize_fifteen.html][quantum computer]]. The complete source code is available in
a GitHub [[https://github.com/Panadestein/bqun][repository]]. 

#+name: generate-bqn-link
#+begin_src emacs-lisp :noweb yes :noweb-prefix no :exports none :results raw
  (let* ((bqn-code (concat "<<preamble>>\n" "<<q>>\n" "<<shor>>\n" "run"))
         (encoded (base64-encode-string (encode-coding-string bqn-code 'utf-8) t)))
    (concat "[[https://mlochbaum.github.io/BQN/try.html#code=" encoded "][BQN repl]]"))
#+end_src
